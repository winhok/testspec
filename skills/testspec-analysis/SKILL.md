---
name: testspec-analysis
description: TestSpec 需求分析和梳理 - 生成或更新 requirements-analysis.md。当用户要做需求分析、梳理可测项、或执行 testspec analysis 时使用。在当前变更目录下产出 requirements-analysis.md（需求拆解、边界与异常、待澄清项），对应流程中的「需求分析和梳理」。
---

# testspec-analysis：需求分析和梳理

## 职责

对需求进行**深度测试分析**，运用测试设计方法识别测试关注点，产出结构化的 `requirements-analysis.md`。核心价值是**发现隐含的测试风险和边界**，而不是把需求文档换个格式重新罗列。

**与 testspec-points 的分工**：analysis 做深度拆解（"为什么要测、有哪些风险"），points 从 analysis 中提炼精简清单（"要测什么"，一句话一条）。

## 当前变更目录

参见 `../testspec-shared/common.md` 中的「当前变更目录定位规则」。

## 执行步骤

1. **确定当前变更目录**。
2. **读取上下文**：读取 `proposal.md`（必须）；若有外部需求文档（PRD、设计稿链接），尽可能获取内容。
3. **运用下述分析方法，生成 requirements-analysis.md**。

---

### 分析目标

识别需要验证的业务行为和质量属性，按 **Functional / Boundary / Exception / Integration / Non-Functional** 五个维度覆盖。分析聚焦"验证什么"（What），不涉及"如何验证"（How）。

### 分析方法论

对每个功能模块，依次考虑以下维度（按需选用，不必每个都机械套用）：

- **功能拆解**：将大功能拆为可独立验证的子功能
- **等价类划分**：识别输入/条件的有效类与无效类
- **边界值分析**：找出临界值（0/1、空/满、最大/最小+1）
- **状态迁移**：梳理状态机（如 进入→游戏中→退出），关注非法状态转换
- **错误推测**：基于经验推测可能出错的场景（网络断开、并发操作、极端数据）
- **兼容性关注**：平台差异、版本兼容、设备适配
- **非功能性**：性能、安全、可用性等横切关注点

### 功能点识别与拆分

从需求中识别以下内容，按 **模块 → 功能点** 层级组织：

- 核心业务模块
- 独立业务动作
- 明确状态变化
- 明确规则或约束

以下内容必须作为独立分析项：

- **CRUD 行为**：创建、读取、更新、删除
- **业务动作**：登录、支付、审核、发布等
- **状态变更**：启用/禁用、成功/失败、通过/拒绝

### 业务规则提取

以下规则必须识别并纳入分析：

- 条件判断（当 A 时，执行 B）
- 限制约束（长度、范围、格式）
- 权限与角色控制

### 数据维度分析

涉及数据的功能，须覆盖以下维度：

- 数据格式正确性
- 数据完整性（必填、关联）
- 数据一致性（跨模块 / 跨系统）
- 数据安全性（敏感数据）

### 异常场景覆盖

必须覆盖以下异常类型：

- **输入异常**：空值、非法值、超长、特殊字符
- **权限异常**：未登录、无权限、会话失效
- **系统异常**：服务不可用、网络异常、超时

### 非功能性关注点

在需求中明确或隐含以下质量属性时，必须纳入分析：

- **性能**：响应时间、并发能力、资源使用
- **安全**：认证与授权、加密传输与存储、输入安全（XSS / SQL 注入）、审计日志
- **易用性**：错误提示清晰度、操作反馈完整性
- **兼容性**：浏览器 / 设备 / 系统兼容、新旧版本兼容
- **可靠性**：异常恢复能力、稳定性、数据保护能力

---

### 分析粒度控制

- 一个分析项只聚焦一个业务意图
- 不以字段为单位拆分
- 不以接口参数为单位拆分
- 出现"且 / 并且 / 同时"时，评估是否拆分为多个分析项
- 分析结论应长期稳定，不随实现细节变化

### 需求不明确处理

当需求未明确说明某行为时：

- 仍进行分析，但标注"需与产品确认"
- 不补充假设性业务规则
- 不推断实现细节

### 禁止事项

- 不包含操作步骤（点击、输入、跳转等）
- 不包含具体测试数据
- 不包含接口字段名或表结构
- 不描述实现方式（Redis、MQ、数据库等）
- 不生成测试用例形式内容

---

### 产出结构

```markdown
# 需求分析：<被测对象>

## 需求来源
- PRD：<链接>
- 设计稿：<链接>

## 功能模块拆解

### 模块 N：<模块名>

**功能描述**：<一句话>

**输入/输出**：
- 输入：<触发条件、数据>
- 输出：<系统响应、UI 变化>

**等价类分析**（若适用）：
| 条件 | 有效等价类 | 无效等价类 |
|------|-----------|-----------|

**边界值**（若适用）：
- <边界>：<临界值及预期>

**状态迁移**（若涉及状态切换）：
- <状态A> → <触发> → <状态B>

**业务规则**：
- <规则>

**风险点**：
- <可能出错的地方及原因>

## 非功能性关注点
- 性能 / 兼容性 / 安全 ...

## 待澄清项
- [ ] <需与产品/开发确认的问题>
```

完整模板见 `../testspec-shared/artifact-templates.md`。

4. **告知用户**：文件路径及下一步可执行 testspec-points 提炼测试要点。

## 产物

- `testspec/changes/<name>/requirements-analysis.md`
