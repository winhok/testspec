---
name: testspec-analysis
description: TestSpec 需求分析和梳理 - 生成或更新 requirements-analysis.md。当用户要做需求分析、梳理可测项、或执行 testspec analysis 时使用。在当前变更目录下产出 requirements-analysis.md（需求拆解、边界与异常、待澄清项），对应流程中的「需求分析和梳理」。
---

# testspec-analysis：需求分析和梳理

## 职责

对需求进行**深度测试分析**，运用测试设计方法识别测试关注点，产出结构化的 `requirements-analysis.md`。这一步的核心价值是**发现隐含的测试风险和边界**，而不是把需求文档换个格式重新罗列。

**与 testspec-points 的分工**：analysis 做深度拆解（"为什么要测、有哪些风险"），points 从 analysis 中提炼精简清单（"要测什么"，一句话一条）。

## 当前变更目录

参见 `.claude/skills/testspec-shared/common.md` 中的「当前变更目录定位规则」。

## 执行步骤

1. **确定当前变更目录**。
2. **读取上下文**：读取 `proposal.md`（必须）；若有外部需求文档（PRD、设计稿链接），尽可能获取内容。
3. **运用测试分析方法，生成 requirements-analysis.md**：

### 分析方法论

对每个功能模块，依次考虑以下维度（按需选用，不必每个都机械套用）：

- **功能拆解**：将大功能拆为可独立验证的子功能
- **等价类划分**：识别输入/条件的有效类与无效类
- **边界值分析**：找出临界值（0/1、空/满、最大/最小+1）
- **状态迁移**：梳理状态机（如 进入→游戏中→退出），关注非法状态转换
- **错误推测**：基于经验推测可能出错的场景（网络断开、并发操作、极端数据）
- **兼容性关注**：平台差异、版本兼容、设备适配
- **非功能性**：性能、安全、可用性等横切关注点

### 产出结构

```markdown
# 需求分析：<被测对象>

## 需求来源
- PRD：<链接>
- 设计稿：<链接>

## 功能模块拆解

### 模块 N：<模块名>

**功能描述**：<一句话>

**输入/输出**：
- 输入：<触发条件、数据>
- 输出：<系统响应、UI 变化>

**等价类分析**（若适用）：
| 条件 | 有效等价类 | 无效等价类 |
|------|-----------|-----------|

**边界值**（若适用）：
- <边界>：<临界值及预期>

**状态迁移**（若涉及状态切换）：
- <状态A> → <触发> → <状态B>

**业务规则**：
- <规则>

**风险点**：
- <可能出错的地方及原因>

## 非功能性关注点
- 性能 / 兼容性 / 安全 ...

## 待澄清项
- [ ] <需与产品/开发确认的问题>
```

完整模板见 `.claude/skills/testspec-shared/artifact-templates.md`。

4. **告知用户**：文件路径及下一步可执行 testspec-points 提炼测试要点。

## 产物

- `testspec/changes/<name>/requirements-analysis.md`
