---
name: testspec-points
description: TestSpec 测试点 - 生成「要测什么」的要点清单（一个文件）。当用户要写测试点、或执行 testspec points 时使用。产出简短测试点列表，供 testspec-generate 再展开为完整测试用例。与测试用例区分：测试点不写完整步骤/预期，只列覆盖要点。
---

# testspec-points：测试点

## 职责

从需求分析结论中**提炼**出简短的测试覆盖要点清单，作为 testspec-generate 的直接输入。

**与 analysis 的关系**：analysis 做深度拆解（等价类、边界值、状态迁移、风险点），points 是 analysis 的"精华版"——把分析结论转化为一条条简短的"要验什么"。如果已有 `requirements-analysis.md`，points 应该从中提炼而非重复分析；如果没有 analysis，points 按默认策略直接从 `proposal.md` 提炼。

---

## 核心定义

### 测试点（Test Point）

- 代表一个**可独立验证的业务或功能验证目标**
- 关注系统行为、业务规则或质量属性
- 不描述"如何测试"，仅描述"验证什么"

### 测试点 ≠ 测试用例 ≠ 校验点

- **测试点**：验证目标（What）
- **测试用例**：操作步骤（How）
- **校验点**：字段 / 状态 / 断言（Check）

## 测试点分类

每个测试点必须归属以下一种类型：

- **功能验证**（Functional）
- **边界验证**（Boundary）
- **异常验证**（Exception）
- **集成验证**（Integration）
- **非功能性验证**（Non-Functional）

## TP_ID 生成规则

格式：`TP_<MODULE>_<FEATURE>_<SEQ>`

- MODULE：2-5 位大写缩写（来自文档顶部「命名字典」）
- FEATURE：2-10 位大写缩写（来自文档顶部「命名字典」）
- 缩写不得临时发明；同一模块/功能点必须长期稳定复用同一缩写
- SEQ 范围按类别：
  - 001–099：Functional
  - 100–199：Boundary
  - 200–299：Exception
  - 300–399：Integration
  - 400–499：Non-Functional

## 优先级规则

每个测试点必须标注优先级：

- **P1**：核心业务链路、权限、安全、资金、数据安全
- **P2**：常规业务功能、重要边界和异常
- **P3**：低频功能、边缘场景、体验类验证

## 粒度控制

- 一个测试点只验证一个业务意图
- 不以字段为单位拆分测试点
- 不以接口参数为单位拆分测试点
- 出现"且 / 并且 / 同时"时，评估是否拆分为多个测试点
- 测试点应长期稳定，不随实现细节变化

## 命名契约（points ↔ generate，必须遵守）

> 目标：建立一套长期稳定、可判定的命名规则，使 points 的“要测什么”和 generate 的“怎么测”在前两段（模块/功能点）严格对齐，第三段分别表达验证意图/测试场景。

### 权威来源（模块/功能点）

- `{模块}`、`{功能点}`只能来自本文档的标题层级：
  - `### {模块}模块`
  - `#### {功能点}功能`
- 禁止使用同义词/缩写/替换词；后续所有 TP/用例标题前两段必须与标题层级 **严格一致**。

### 命名字典（用于 TP_ID 缩写映射）

`specs/testpoints.md` 顶部必须包含「命名字典」，用于将中文标题层级映射为 `TP_ID` 所需缩写（同一模块/功能点长期稳定复用）：

- 模块字典：`模块名称 → MODULE`
- 功能点字典：`模块名称 + 功能点名称 → FEATURE`

约束：
- `MODULE` 只允许 `A-Z`，长度 2-5
- `FEATURE` 只允许 `A-Z`，长度 2-10

示例（结构示意）：

```markdown
## 命名字典

### 模块字典
| 模块名称 | MODULE |
|---|---|
| 登录 | LOGIN |

### 功能点字典
| 模块名称 | 功能点名称 | FEATURE |
|---|---|---|
| 登录 | 凭据验证 | CRED |
```

### 测试点名称（TP 标题）

- `<测试点名称>` 格式强制：`{模块}_{功能点}_{验证意图}`
- 仅允许 3 段（即只出现 2 个 `_`）；不得额外分段
- `{模块}`、`{功能点}`必须与当前标题层级完全一致
- `{验证意图}`保持“验证什么（What）”粒度：
  - 禁止步骤词（点击/输入/跳转/选择/上传…）
  - 禁止具体测试数据（如具体手机号/邮箱/固定数值阈值等）
  - 禁止字段名样式（snake_case/camelCase，如 `user_id`、`userId`）
  - 禁止实现方式（Redis/MQ/数据库/表结构/索引…）

### generate 用例标题（映射规则）

- 用例标题格式强制：`{模块}_{功能点}_{测试场景}`（同样只允许 3 段）
- `{模块}`、`{功能点}`必须与 points 标题层级严格一致
- 一个 TP 可映射多个用例：同一 TP 派生的所有用例标题共享相同前缀 `{模块}_{功能点}_...`
- `{测试场景}`允许轻量场景词（正确/错误/边界/异常/权限不足/网络超时等），但避免具体数据

### 自检清单（可判定）

生成 `specs/testpoints.md` 后必须自检：

- 文档顶部存在「命名字典」，且覆盖文档中出现的所有 `{模块}`/`{功能点}`
- 每条 `<测试点名称>` 满足：`^[^_\s]+_[^_\s]+_[^_\s]+$` 且前两段严格等于标题层级
- 标题/验证要点中不出现步骤词、具体数据、字段名样式、实现关键词

---

## 禁止事项（严格）

- 不包含操作步骤（点击、输入、跳转等）
- 不包含具体测试数据
- 不包含接口字段名或表结构
- 不描述实现方式（Redis、MQ、数据库等）
- 不生成测试用例形式内容

---

## 当前变更目录

参见 `.claude/skills/testspec-shared/common.md` 中的「当前变更目录定位规则」。

## 执行步骤

1. **确定当前变更目录**。
2. **读取上下文**：
   - 优先读 `requirements-analysis.md`（从中提炼）
   - 若不存在，读 `proposal.md`（直接提炼）
3. **生成 specs/testpoints.md**：

### 提炼原则

- 按模块/功能点组织，并按类别分区（Functional / Boundary / Exception / Integration / Non-Functional）
- 每条测试点必须包含：TP_ID、测试点名称、验证要点、优先级（P1/P2/P3）、关联需求
- 确保覆盖 analysis 中识别的风险点和边界值
- 不确定项标注"需与产品确认"，优先级设为 P3，不补充假设性业务规则

### 输出质量要求

- 测试点必须完整覆盖需求
- 测试点之间不得重复
- 每个测试点必须可独立验证
- 测试点应可直接用于后续测试用例设计

### 默认行为

- 未特别说明时，按"最小充分覆盖"原则生成测试点
- 不主动扩展需求之外的业务场景
- 不推断实现细节

### 产出结构

```markdown
# 测试点：<被测对象>

## 概述
<一两句话说明本次测试覆盖范围与重点>

## 命名字典

### 模块字典
| 模块名称 | MODULE |
|---|---|
| <模块名称> | <2-5 位大写缩写> |

### 功能点字典
| 模块名称 | 功能点名称 | FEATURE |
|---|---|---|
| <模块名称> | <功能点名称> | <2-10 位大写缩写> |

### [模块名称]模块

#### [功能点名称]功能

##### 功能验证点 (Functional)

- TP_<MODULE>_<FEATURE>_001: <测试点名称（格式：{模块}_{功能点}_{验证意图}）>
  - 验证要点: <验证什么（What），不写步骤/数据>
  - 优先级: P1/P2/P3
  - 关联需求: <需求编号/段落>

##### 边界验证点 (Boundary)

##### 异常验证点 (Exception)

##### 集成验证点 (Integration)

##### 非功能性验证点 (Non-Functional)
```

4. **告知用户**：产出路径及下一步可执行 testspec-generate。

## 产物

- `testspec/changes/<name>/specs/testpoints.md`
